{% extends 'tasks/base.html' %}

{% block title %}Create Template from Tasks - Todo Manager{% endblock %}

{% block content %}
<div class="from-tasks-container">
    
    <!-- Header -->
    <div class="page-header">
        <h1 class="page-title">Create Template from Existing Tasks</h1>
        <p class="page-subtitle">Select tasks to turn into a reusable template</p>
    </div>
    
    <form method="POST" class="from-tasks-form">
        {% csrf_token %}
        
        <!-- Template Info -->
        <div class="template-info-card">
            <h2 class="card-title">Template Information</h2>
            
            <div class="form-group">
                <label for="template_name" class="form-label">
                    <span class="label-icon">ğŸ“‹</span>
                    <span>Template Name</span>
                </label>
                <input 
                    type="text" 
                    id="template_name" 
                    name="template_name" 
                    class="form-input" 
                    placeholder="e.g., My Weekly Routine"
                    required
                >
            </div>
            
            <div class="form-group">
                <label for="template_icon" class="form-label">
                    <span class="label-icon">ğŸ˜€</span>
                    <span>Icon</span>
                </label>
                <input 
                    type="text" 
                    id="template_icon" 
                    name="template_icon" 
                    class="form-input" 
                    value="ğŸ“‹"
                    maxlength="10"
                >
                
                <!-- Quick Emoji Picker -->
                <div class="emoji-picker">
                    <button type="button" class="emoji-btn" onclick="setIcon('ğŸ“‹')">ğŸ“‹</button>
                    <button type="button" class="emoji-btn" onclick="setIcon('âœ…')">âœ…</button>
                    <button type="button" class="emoji-btn" onclick="setIcon('ğŸ ')">ğŸ </button>
                    <button type="button" class="emoji-btn" onclick="setIcon('ğŸ’¼')">ğŸ’¼</button>
                    <button type="button" class="emoji-btn" onclick="setIcon('ğŸ›’')">ğŸ›’</button>
                    <button type="button" class="emoji-btn" onclick="setIcon('ğŸ§¹')">ğŸ§¹</button>
                </div>
            </div>
        </div>
        
        <!-- Task Selection -->
        <div class="task-selection-card">
            <h2 class="card-title">
                Select Tasks 
                <span class="selection-count">(Selected: <span id="selectedCount">0</span>)</span>
            </h2>
            
            <div class="tasks-list">
                {% for task in tasks %}
                <label class="task-checkbox-card">
                    <input 
                        type="checkbox" 
                        name="task_ids" 
                        value="{{ task.id }}"
                        class="task-selector"
                        onchange="updateCount()"
                    >
                    <div class="task-check-content">
                        <div class="task-check-title">{{ task.title }}</div>
                        {% if task.description %}
                        <div class="task-check-description">{{ task.description|truncatewords:10 }}</div>
                        {% endif %}
                        <div class="task-check-meta">
                            <span class="priority-badge priority-{{ task.priority }}">
                                {{ task.get_priority_display }}
                            </span>
                            {% if task.is_recurring %}
                            <span class="recurring-badge-small">ğŸ”„</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="task-checkmark">âœ“</div>
                </label>
                {% empty %}
                <div class="empty-state">
                    <p>No pending tasks found. Create some tasks first!</p>
                    <a href="/create/" class="btn btn-primary">
                        <span>â•</span>
                        <span>Create Task</span>
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <!-- Actions -->
        <div class="form-actions">
            <button type="submit" class="btn btn-primary btn-large" id="submitBtn" disabled>
                <span>âœ¨</span>
                <span>Create Template</span>
            </button>
            <a href="{% url 'templates_list' %}" class="btn btn-secondary">
                <span class="text1">Cancel</span>
            </a>
        </div>
    </form>
</div>

<script>
function setIcon(emoji) {
    document.getElementById('template_icon').value = emoji;
}

function updateCount() {
    const checkboxes = document.querySelectorAll('.task-selector:checked');
    const count = checkboxes.length;
    document.getElementById('selectedCount').textContent = count;
    
    // Enable/disable submit button
    const submitBtn = document.getElementById('submitBtn');
    if (count > 0) {
        submitBtn.disabled = false;
    } else {
        submitBtn.disabled = true;
    }
}
</script>
{% endblock %}