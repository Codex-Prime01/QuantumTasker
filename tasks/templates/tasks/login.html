{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="stylesheet" href="{% static 'tasks/style.css' %}">
</head>

<body>

    <body>
        <!-- Toast Notifications Container -->
        <div class="toast-container" id="toastContainer">
            {% if messages %}
            {% for message in messages %}
            <div class="toast toast-{{ message.tags }} show" role="alert">
                <div class="toast-content">
                    <span class="toast-message">{{ message }}</span>
                    <button class="toast-close" onclick="this.parentElement.parentElement.remove()">‚úï</button>
                </div>
            </div>
            {% endfor %}
            {% endif %}
        </div>


        <div class="container">
            <header>
                <h1 class="title">
                    <span class="glow">Welcome</span> Back
                </h1>
            </header>

            <div class="centerColumn">
                <div class="auth-form-wrapper">
                    <form method="POST" class="auth-form">
                        {% csrf_token %}

                        {% if form.errors %}
                        <div class="error-box">
                            <p class="error-title">‚ö†Ô∏è Login Failed</p>
                            <p class="error-message">Please check your username or password.</p>
                        </div>
                        {% endif %}

                        <div class="form-group">
                            <label for="{{ form.username.id_for_label }}" class="form-label">Username</label>
                            {{ form.username }}
                        </div>

                        <div class="form-group">
                            <label for="{{ form.password.id_for_label }}" class="form-label">Password</label>
                            <div class="password-wrapper">
                                {{ form.password }}
                                <button type="button" class="toggle-password" data-target="id_password">
                                    <span class="eye-icon">üëÅÔ∏è</span>
                                </button>
                            </div>

                            <a href="{% url 'forgot_password' %}" class="forgot-password-link">
                                Forgot password?
                            </a>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-login">
                                <span>üîì</span>
                                <span>Login</span>
                            </button>
                        </div>

                        <div class="auth-switch">
                            <p>Don't have an account? <a href="/register/" class="auth-link">Create one here</a></p>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <script>
            // Password visibility toggle (same as register page)
            const toggleButtons = document.querySelectorAll('.toggle-password');

            toggleButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const targetId = this.getAttribute('data-target');
                    const passwordInput = document.getElementById(targetId);

                    if (passwordInput.type === 'password') {
                        passwordInput.type = 'text';
                        this.classList.add('visible');
                        this.querySelector('.eye-icon').textContent = 'Hide';
                    } else {
                        passwordInput.type = 'password';
                        this.classList.remove('visible');
                        this.querySelector('.eye-icon').textContent = 'üëÅÔ∏è';
                    }
                });
            });


            // Show loading overlay when form is submitted
            document.addEventListener('DOMContentLoaded', function () {
                const forms = document.querySelectorAll('form');
                const loadingOverlay = document.getElementById('loadingOverlay');

                forms.forEach(form => {
                    form.addEventListener('submit', function (e) {
                        // Show loading overlay
                        if (loadingOverlay) {
                            loadingOverlay.classList.add('active');
                        }

                        // Add loading class to submit button
                        const submitBtn = form.querySelector('button[type="submit"], input[type="submit"]');
                        if (submitBtn) {
                            submitBtn.classList.add('loading');
                            submitBtn.disabled = true;
                        }
                    });
                });

                // Auto-hide toasts after 5 seconds
                const toasts = document.querySelectorAll('.toast');
                toasts.forEach(toast => {
                    setTimeout(() => {
                        toast.style.animation = 'fadeOut 0.5s ease-in forwards';
                        setTimeout(() => toast.remove(), 500);
                    }, 5000);
                });
            });
        </script>
    </body>

</html>