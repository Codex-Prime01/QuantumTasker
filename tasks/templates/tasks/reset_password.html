{% extends 'tasks/base.html' %}

{% block title %}Reset Password - Quantum Manager{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-card">
        <div class="auth-header">
            <div class="auth-icon">ğŸ”</div>
            <h1 class="auth-title">Reset Password</h1>
            <p class="auth-subtitle">Hi {{ username }}! Enter your new password below.</p>
        </div>
        
        <form method="POST" class="auth-form" id="resetForm">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="password1" class="form-label">
                    <span class="label-icon">ğŸ”’</span>
                    <span>New Password</span>
                </label>
                <div class="password-input-wrapper">
                    <input 
                        type="password" 
                        id="password1" 
                        name="password1" 
                        class="form-input password-input" 
                        placeholder="Enter new password"
                        required
                        minlength="8"
                    >
                    <button type="button" class="toggle-password" onclick="togglePassword('password1')">
                        ğŸ‘ï¸
                    </button>
                </div>
                <div class="password-strength" id="strengthBar"></div>
                <p class="form-hint" id="strengthText">At least 8 characters</p>
            </div>
            
            <div class="form-group">
                <label for="password2" class="form-label">
                    <span class="label-icon">ğŸ”’</span>
                    <span>Confirm New Password</span>
                </label>
                <div class="password-input-wrapper">
                    <input 
                        type="password" 
                        id="password2" 
                        name="password2" 
                        class="form-input password-input" 
                        placeholder="Confirm new password"
                        required
                        minlength="8"
                    >
                    <button type="button" class="toggle-password" onclick="togglePassword('password2')">
                        ğŸ‘ï¸
                    </button>
                </div>
                <p class="form-hint match-hint" id="matchHint"></p>
            </div>
            
            <button type="submit" class="btn btn-primary btn-full">
                <span>âœ…</span>
                <span>Reset Password</span>
            </button>
        </form>
        
        <div class="auth-footer">
            <a href="{% url 'login' %}" class="footer-link">
                â† Back to Login
            </a>
        </div>
    </div>
    
    <!-- Password Requirements -->
    <div class="password-requirements">
        <h3>Password Requirements:</h3>
        <ul>
            <li id="req-length">âœ“ At least 8 characters</li>
            <li id="req-match">âœ“ Passwords match</li>
        </ul>
    </div>
</div>

<script>
// Toggle password visibility
function togglePassword(fieldId) {
    const field = document.getElementById(fieldId);
    const button = field.nextElementSibling;
    
    if (field.type === 'password') {
        field.type = 'text';
        button.textContent = 'ğŸ™ˆ';
    } else {
        field.type = 'password';
        button.textContent = 'ğŸ‘ï¸';
    }
}

// Password strength checker
document.getElementById('password1').addEventListener('input', function(e) {
    const password = e.target.value;
    const strengthBar = document.getElementById('strengthBar');
    const strengthText = document.getElementById('strengthText');
    const reqLength = document.getElementById('req-length');
    
    let strength = 0;
    let text = '';
    let color = '';
    
    // Length check
    if (password.length >= 8) {
        strength += 25;
        reqLength.style.color = '#4CAF50';
        reqLength.innerHTML = 'âœ… At least 8 characters';
    } else {
        reqLength.style.color = 'rgba(255, 255, 255, 0.5)';
        reqLength.innerHTML = 'âœ“ At least 8 characters';
    }
    
    // Has uppercase
    if (/[A-Z]/.test(password)) strength += 25;
    
    // Has lowercase
    if (/[a-z]/.test(password)) strength += 25;
    
    // Has number
    if (/[0-9]/.test(password)) strength += 25;
    
    // Determine strength level
    if (strength === 0) {
        text = 'Enter a password';
        color = 'rgba(255, 255, 255, 0.2)';
    } else if (strength <= 25) {
        text = 'Weak password';
        color = '#F44336';
    } else if (strength <= 50) {
        text = 'Fair password';
        color = '#FF9800';
    } else if (strength <= 75) {
        text = 'Good password';
        color = '#FFC107';
    } else {
        text = 'Strong password! ğŸ’ª';
        color = '#4CAF50';
    }
    
    strengthBar.style.width = strength + '%';
    strengthBar.style.background = color;
    strengthText.textContent = text;
    strengthText.style.color = color;
    
    checkPasswordMatch();
});

// Check if passwords match
function checkPasswordMatch() {
    const password1 = document.getElementById('password1').value;
    const password2 = document.getElementById('password2').value;
    const matchHint = document.getElementById('matchHint');
    const reqMatch = document.getElementById('req-match');
    
    if (password2.length === 0) {
        matchHint.textContent = '';
        matchHint.style.color = '';
        reqMatch.style.color = 'rgba(255, 255, 255, 0.5)';
        reqMatch.innerHTML = 'âœ“ Passwords match';
        return;
    }
    
    if (password1 === password2) {
        matchHint.textContent = 'âœ… Passwords match!';
        matchHint.style.color = '#4CAF50';
        reqMatch.style.color = '#4CAF50';
        reqMatch.innerHTML = 'âœ… Passwords match';
    } else {
        matchHint.textContent = 'âŒ Passwords do not match';
        matchHint.style.color = '#F44336';
        reqMatch.style.color = 'rgba(255, 255, 255, 0.5)';
        reqMatch.innerHTML = 'âœ“ Passwords match';
    }
}

document.getElementById('password2').addEventListener('input', checkPasswordMatch);

// Form validation
document.getElementById('resetForm').addEventListener('submit', function(e) {
    const password1 = document.getElementById('password1').value;
    const password2 = document.getElementById('password2').value;
    
    if (password1.length < 8) {
        e.preventDefault();
        alert('âŒ Password must be at least 8 characters long!');
        return false;
    }
    
    if (password1 !== password2) {
        e.preventDefault();
        alert('âŒ Passwords do not match!');
        return false;
    }
});
</script>
{% endblock %}