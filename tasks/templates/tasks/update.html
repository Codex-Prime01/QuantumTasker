{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Task</title>
    <link rel="stylesheet" href="{% static 'tasks/style.css' %}">
</head>

<body>

    <body>
        <!-- Toast Notifications Container -->
        <div class="toast-container" id="toastContainer">
            {% if messages %}
            {% for message in messages %}
            <div class="toast toast-{{ message.tags }} show" role="alert">
                <div class="toast-content">
                    <span class="toast-message">{{ message }}</span>
                    <button class="toast-close" onclick="this.parentElement.parentElement.remove()">‚úï</button>
                </div>
            </div>
            {% endfor %}
            {% endif %}
        </div>

        <!-- Rest of your page content -->

        <div class="container">
            <header>
                <h1 class="title">
                    <span class="glow">Update</span>
                </h1>
            </header>

            <div class="centerColumn">
                <div class="update-form-wrapper">
                    <form action="" method="POST" class="update-form">
                        {% csrf_token %}

                        <div class="form-group">
                            <label for="id_title" class="form-label">Task Title</label>
                            {{ form.title }}
                        </div>

                        <div class="form-group">
                            <label for="id_description" class="form-label">Description</label>
                            {{ form.description }}
                        </div>

                        <!-- üëá NEW! Due Date & Priority -->
                        <div class="form-row">
                            <div class="form-group">
                                <label for="id_due_date" class="form-label">Due Date</label>
                                {{ form.due_date }}
                            </div>

                            <div class="form-group">
                                <label for="id_priority" class="form-label">Priority</label>
                                {{ form.priority }}
                            </div>
                        </div>


                        <div class="form-group">
                            <label class="form-label">Categories (optional)</label>
                            <div class="select-wrapper">
                                {{ form.categories }}
                                <span class="select-arrow"></span>
                            </div>
                            <div class="selected-categories-preview" id="selected-preview">
                                <!-- Selected categories will appear here as tags here -->
                            </div>
                        </div>


                        <div class="form-group full-width recurring-section">
                            <div class="recurring-header">
                                <label class="form-label">
                                    <span class="label-icon">üîÑ</span>
                                    <span>Recurring Task</span>
                                </label>
                                <label class="toggle-switch">
                                    {{ form.is_recurring }}
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <p class="form-hint">{{ form.is_recurring.help_text }}</p>

                            <div class="recurring-options" id="recurringOptions" style="display: none;">
                                <div class="form-group">
                                    <label class="form-label" for="{{ form.recurring_frequency.id_for_label }}">
                                        <span class="label-icon">üìÖ</span>
                                        <span>{{ form.recurring_frequency.label }}</span>
                                    </label>
                                    {{ form.recurring_frequency }}
                                    <p class="form-hint">{{ form.recurring_frequency.help_text }}</p>
                                </div>

                                <div class="form-group" id="customIntervalGroup" style="display: none;">
                                    <label class="form-label" for="{{ form.recurring_interval.id_for_label }}">
                                        <span class="label-icon">üî¢</span>
                                        <span>{{ form.recurring_interval.label }}</span>
                                    </label>
                                    {{ form.recurring_interval }}
                                    <p class="form-hint">{{ form.recurring_interval.help_text }}</p>
                                </div>

                                <div class="recurring-preview">
                                    <p class="preview-text" id="recurringPreview">
                                        <strong>Preview:</strong> <span id="previewText">Task will repeat daily</span>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="id_complete" class="checkbox-label">
                                {{ form.complete }}
                                <span class="checkbox-custom"></span>
                                <span class="checkbox-text">Mark as Complete</span>
                            </label>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-update">
                                <span>üíæ</span>
                                <span>Update Task</span>
                            </button>
                            <a href="/" class="btn btn-cancel">
                                <span>‚ùå</span>
                                <span>Cancel</span>
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <script>
            // Show loading overlay when form is submitted
            document.addEventListener('DOMContentLoaded', function () {
                const forms = document.querySelectorAll('form');
                const loadingOverlay = document.getElementById('loadingOverlay');

                forms.forEach(form => {
                    form.addEventListener('submit', function (e) {
                        // Show loading overlay
                        if (loadingOverlay) {
                            loadingOverlay.classList.add('active');
                        }

                        // Add loading class to submit button
                        const submitBtn = form.querySelector('button[type="submit"], input[type="submit"]');
                        if (submitBtn) {
                            submitBtn.classList.add('loading');
                            submitBtn.disabled = true;
                        }
                    });
                });

                // Auto-hide toasts after 5 seconds
                const toasts = document.querySelectorAll('.toast');
                toasts.forEach(toast => {
                    setTimeout(() => {
                        toast.style.animation = 'fadeOut 0.5s ease-in forwards';
                        setTimeout(() => toast.remove(), 500);
                    }, 5000);
                });
            });


            document.addEventListener('DOMContentLoaded', function () {
                const isRecurringToggle = document.getElementById('id_is_recurring');
                const recurringOptions = document.getElementById('recurringOptions');
                const frequencySelect = document.getElementById('id_recurring_frequency');
                const customIntervalGroup = document.getElementById('customIntervalGroup');
                const intervalInput = document.getElementById('id_recurring_interval');
                const previewText = document.getElementById('previewText');

                // Show/hide recurring options
                isRecurringToggle.addEventListener('change', function () {
                    if (this.checked) {
                        recurringOptions.style.display = 'block';
                        updatePreview();
                    } else {
                        recurringOptions.style.display = 'none';
                    }
                });

                // Show/hide custom interval
                frequencySelect.addEventListener('change', function () {
                    if (this.value === 'custom') {
                        customIntervalGroup.style.display = 'block';
                    } else {
                        customIntervalGroup.style.display = 'none';
                    }
                    updatePreview();
                });

                // Update preview on interval change
                intervalInput.addEventListener('input', updatePreview);

                // Update preview text
                function updatePreview() {
                    const frequency = frequencySelect.value;
                    const interval = intervalInput.value || 1;

                    const previewMap = {
                        'none': 'Task does not repeat',
                        'daily': 'Task will repeat every day',
                        'weekly': 'Task will repeat every week',
                        'biweekly': 'Task will repeat every 2 weeks',
                        'monthly': 'Task will repeat every month',
                        'yearly': 'Task will repeat every year',
                        'custom': `Task will repeat every ${interval} day${interval > 1 ? 's' : ''}`
                    };

                    previewText.textContent = previewMap[frequency] || 'Select a frequency';
                }

                // Check if recurring is already enabled (edit mode)
                if (isRecurringToggle.checked) {
                    recurringOptions.style.display = 'block';
                    if (frequencySelect.value === 'custom') {
                        customIntervalGroup.style.display = 'block';
                    }
                    updatePreview();
                }
            });
        </script>

    </body>

</html>